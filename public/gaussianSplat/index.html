<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D Gaussian Splat Demo - Garden</title>
  <script type="text/javascript" src="js/util.js"></script>
  <script type="importmap">
    {
        "imports": {
            "three": "./lib/three.module.js",
            "@mkkellogg/gaussian-splats-3d": "./lib/gaussian-splats-3d.module.js"
        }
    }
  </script>
  <style>

    body {
      background-color: #000000;
      height: 100vh;
      margin: 0px;
    }

  </style>

</head>

<body>
  <script type="module">
    import * as GaussianSplats3D from '@mkkellogg/gaussian-splats-3d';
    import * as THREE from 'three';

    
    window.addEventListener("message", async (event) => {
      const { data } = event;

      // 加载 gaussian.json
      try {
        const response = await fetch('model-url.json');
        const urlData = await response.json();

        if (urlData.base === '__AUTO_BASE__') {
          urlData.base = window.location.origin + '/';
          // console.log(46666, urlData.base);

          const pathId = parseInt(data.pageParams.id);
          let path = ''
          switch (pathId) {
            case 1:
              path = urlData.base + urlData.models.huabiao; break;
            case 2:
              path = urlData.base + urlData.models.boyata; break;
            case 3:
              path = urlData.base + urlData.models.lidazhao; break;
            default:
              path = urlData.base + urlData.models.huabiao; break;
          }
        console.log('path:', path);
        
          const urlParams = new URLSearchParams(window.location.search);
          const mode = parseInt(urlParams.get('mode')) || 0;
        
          const viewer = new GaussianSplats3D.Viewer({
              'cameraUp': [0, -1, 0],
              'initialCameraPosition': [0.2545772143590187, -0.022421991409040026, -5.515991088728122],
              'initialCameraLookAt': [0, 0, 0],
              'sphericalHarmonicsDegree': 2,
          });
          viewer.addSplatScene(path, 
          {
            'progressiveLoad': true
          }
        ).then(() => {
          viewer.start();
        });
        }

      } catch (e) {
        console.error('Error loading model-url.json:', e);
        return;
      }
    })

  </script>
</body>

</html>